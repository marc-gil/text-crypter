<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <title>text-crypter</title>
</head>

<body>
    <div class="container p-3">
        <form id="crypt-form">
            <div class="mb-3">
                <label class="form-label">Text a encriptar</label>
                <input id="text" class="form-control" type="text">
            </div>
            <div class="mb-3">
                <label class="form-label">Clau d'encriptació</label>
                <div class="input-group">
                    <input id="password" class="form-control" type="password">
                    <button id="eye-btn" class="btn btn-outline-secondary" type="button">
                        <i class="bi bi-eye-fill"></i>
                    </button>
                </div>
            </div>
            <div class="mb-3 text-center">
                <button id="encriptar" class="btn btn-primary w-50" type="submit">Encripta</button>
            </div>
        </form>
        <div style="display: none;">
            <label class="form-label">Enllaç de desencriptació</label>
            <div class="card">
                <div class="card-body bg-light">
                    <div class="mb-1">
                        <button id="copy-btn" class="btn btn-outline-secondary btn-sm me-1" type="button">
                            <i class="bi bi-clipboard"></i>
                        </button>
                        <a id="encrypted-link" href="#" class="link-primary" target="_blank"></a>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        const cryptForm = document.getElementById('crypt-form');
        const password = document.getElementById('password');
        const text = document.getElementById("text");
        const encryptedLink = document.getElementById("encrypted-link");
        const baseUrl = "https://marc-gil.github.io/text-crypter?encrypted-text=";
        const copyBtn = document.getElementById("copy-btn");
        const eyeBtn = document.getElementById("eye-btn");
        
        function encryptText(text, password) {
            const encrypted = CryptoJS.AES.encrypt(text, password);
            return encrypted;
        }

        function decryptText(text, password) {
            const decrypted = CryptoJS.AES.decrypt(text, password);
            return decrypted.toString(CryptoJS.enc.Utf8);
        }

        cryptForm.addEventListener('submit', function (event) {
            event.preventDefault();
            // Encrypt the password using AES encryption
            const encryptedResult = encryptText(text.value, password.value).toString();
            const url = baseUrl + encodeURIComponent(encryptedResult);
            encryptedLink.href = "data:text/plain;charset=utf-8," + url;
            encryptedLink.textContent = url;
            const hiddenDiv = document.querySelector('.card').parentNode;
            hiddenDiv.style.display = 'block';
        });

        copyBtn.addEventListener("click", function () {
            navigator.clipboard.writeText(encryptedLink.textContent);
            copyBtn.blur();
        });

        eyeBtn.addEventListener("click", function () {
            password.type = password.type === "password" ? "text" : "password";
            eyeBtn.blur();
        });

    </script>
</body>

</html>